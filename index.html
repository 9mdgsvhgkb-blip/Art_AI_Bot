<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Fenix AI</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Telegram -->
<script src="https://telegram.org/js/telegram-widget.js?22"></script>

<style>
*{box-sizing:border-box}
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto;
  background:#0b0e1a;
  color:#fff;
  min-height:100vh;
}
.header{
  padding:16px 18px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.logo{
  font-size:22px;
  font-weight:800;
}
.avatar{
  width:36px;
  height:36px;
  border-radius:50%;
  background:#333;
  overflow:hidden;
}
.avatar img{width:100%;height:100%;object-fit:cover}
.main{
  padding:40px 18px;
}
.btn{
  width:100%;
  padding:18px;
  font-size:16px;
  font-weight:700;
  border:none;
  border-radius:18px;
  background:linear-gradient(135deg,#e6c07b,#f3ddb0);
  color:#1a1408;
  cursor:pointer;
}
.btn:active{transform:scale(.96)}
.hidden{display:none}

/* MODAL */
.overlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.65);
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:10;
}
.modal{
  width:90%;
  max-width:360px;
  background:#14172b;
  border-radius:24px;
  padding:24px;
  text-align:center;
}
.modal h3{margin-top:0}
.loader{
  width:48px;
  height:48px;
  border:4px solid #333;
  border-top:4px solid #e6c07b;
  border-radius:50%;
  animation:spin 1s linear infinite;
  margin:20px auto;
}
@keyframes spin{to{transform:rotate(360deg)}}
</style>
</head>

<body>

<div class="header">
  <div class="logo">Fenix AI</div>
  <div class="avatar" id="avatar"></div>
</div>

<div class="main">
  <h2>Нарезка видео с AI</h2>
  <p style="opacity:.6">Загрузи видео — получи лучшие клипы с субтитрами</p>
  <button class="btn" id="openUpload">Создать клипы</button>
</div>

<!-- LOGIN MODAL -->
<div class="overlay hidden" id="loginModal">
  <div class="modal">
    <h3>Вход через Telegram</h3>
    <div id="tgLogin"></div>
  </div>
</div>

<!-- UPLOAD MODAL -->
<div class="overlay hidden" id="uploadModal">
  <div class="modal">
    <h3>Загрузка видео</h3>
    <input type="file" id="fileInput" accept="video/*">
    <button class="btn" id="startUpload" style="margin-top:16px">Начать резку</button>
  </div>
</div>

<!-- LOADING -->
<div class="overlay hidden" id="loadingModal">
  <div class="modal">
    <h3>Обработка</h3>
    <div class="loader"></div>
    <p>AI режет видео…</p>
  </div>
</div>

<script>
const API_BASE = "https://fenixaibot.online";
let user = null;
let file = null;

const loginModal = document.getElementById("loginModal");
const uploadModal = document.getElementById("uploadModal");
const loadingModal = document.getElementById("loadingModal");
const avatar = document.getElementById("avatar");

document.getElementById("openUpload").onclick = () => {
  if(!user) loginModal.classList.remove("hidden");
  else uploadModal.classList.remove("hidden");
};

/* TG LOGIN */
window.onTelegramAuth = u => {
  user = u;
  localStorage.setItem("tg_user", JSON.stringify(u));
  loginModal.classList.add("hidden");
  uploadModal.classList.remove("hidden");
  if(u.photo_url){
    avatar.innerHTML = `<img src="${u.photo_url}">`;
  }
};

const saved = localStorage.getItem("tg_user");
if(saved){
  user = JSON.parse(saved);
  if(user.photo_url){
    avatar.innerHTML = `<img src="${user.photo_url}">`;
  }
}

/* INIT TG WIDGET */
document.getElementById("tgLogin").innerHTML = `
<script async src="https://telegram.org/js/telegram-widget.js?22"
 data-telegram-login="FenixAi_Robot"
 data-size="large"
 data-userpic="false"
 data-onauth="onTelegramAuth">
<\/script>`;

/* FILE */
document.getElementById("fileInput").onchange = e=>{
  file = e.target.files[0];
};

/* UPLOAD */
document.getElementById("startUpload").onclick = async ()=>{
  if(!file) return alert("Выберите видео");
  uploadModal.classList.add("hidden");
  loadingModal.classList.remove("hidden");

  const fd = new FormData();
  fd.append("file", file);
  fd.append("max_highlights", 3);

  await fetch(`${API_BASE}/upload`, {
    method:"POST",
    body:fd
  });
};
</script>

</body>
</html>
